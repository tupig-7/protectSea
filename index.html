<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>å¤§é±¼åƒå°é±¼</title>
  <link href="css/index.css" />
  <link rel="stylesheet" href="dist/jspanel.css">
  <script src="js/jquery-3.3.1.min.js"></script>
</head>
<style type="text/css">
	#trash{
	    position: absolute;
	    width: 50px;
		height: 60px;
	    background: cadetblue;
	    color: #fff;
	    padding: 0px;
	}
</style>
<body background="img/sea.jpg">
<div class="container">
	<img src="img/explorer.jpg" style="width: 50px; height: 60px;" id="trash"/>
</div>

<script src="dist/jspanel.js"></script>
    <!-- optionally load jsPanel extensions -->
    <script src="dist/extensions/contextmenu/jspanel.contextmenu.js"></script>
    <script src="dist/extensions/hint/jspanel.hint.js"></script>
    <script src="dist/extensions/modal/jspanel.modal.js"></script>
    <script src="dist/extensions/tooltip/jspanel.tooltip.js"></script>
    <script src="dist/extensions/dock/jspanel.dock.js"></script>
<script>
	var grade = 0;//è®¡åˆ†
	var KEY = {
		UP: 38,
		DOWN: 40,
		LEFT:37,
		RIGHT:39
	}
	var fishes  = [0,0,0,0,0,0];//ç”¨æ¥åˆ¤æ–­é±¼æ˜¯å¦è¢«åƒæ‰
	var trashes = {};
	trashes.pressedKeys = [];
	trashes.width = $("#trash").css("width");
	trashes.height = $("#trash").css("height");
	$(function(){
		//è®¾ç½®Intervalç”¨äºæ¯30æ¯«ç§’è°ƒç”¨ä¸€æ¬¡gameloopå‡½æ•°
		trashes.timer = setInterval(gameloop, 30);
		//æ ‡è®°pressedKeysæ•°ç»„ä¸­æŸä¸ªé”®æ˜¯æŒ‰ä¸‹è¿˜æ˜¯æ”¾å¼€
		$(document).keydown(function(e){
			trashes.pressedKeys[e.which] = true;
		});
		$(document).keyup(function(e){
			trashes.pressedKeys[e.which] = false;
		});
		console.log(trashes)
	});
	function gameloop(){
		moveTrash();
		for(var i = 0; i<6;i++){
			if(fishes[i] == 1)
			{
				var div1 = document.getElementById("trash");
				var div2 = document.getElementById("fish"+i);
				if(check(div1, div2)){
					width = parseInt($("#trash").css('width'));
					height = parseInt($("#trash").css('height'));
					div1.style.width = width * 1.1 + "px";
					div1.style.height = height * 1.1 + "px";
					console.log(width*1.1)
					div2.remove();
					fishes[i] = 0;
					getAnothgerFish(i);
					grade += 10;
				}
			}
			
				
		}
		
	}
	function moveTrash(){
		//ä½¿ç”¨è‡ªå®šä¹‰å®šæ—¶å™¨ä¸æ–­æ£€æµ‹æ˜¯å¦æœ‰æŒ‰é”®è¢«æŒ‰ä¸‹
		var t = document.getElementById("trash");
		
		if(trashes.pressedKeys[KEY.UP]){//å‘ä¸Šé”®
			//	æŠŠåƒåœ¾å‘ä¸Šç§»åŠ¨äº”ä¸ªåƒç´ 
			if(t.offsetTop >= 10)
				t.style.top = t.offsetTop - 10 + "px";
		}
		if(trashes.pressedKeys[KEY.DOWN]){//å‘ä¸‹é”®
			//	æŠŠåƒåœ¾å‘ä¸‹ç§»åŠ¨äº”ä¸ªåƒç´ 
			if(t.offsetTop <= window.screen.availHeight - 10)
				t.style.top = t.offsetTop + 10 + "px";
		}
		if(trashes.pressedKeys[KEY.LEFT]){//å‘å·¦é”®
		
			if(t.offsetLeft >= 10)
				t.style.left =  t.offsetLeft - 10 + "px";
		}
		if(trashes.pressedKeys[KEY.RIGHT]){//å‘å³é”®
			if(t.offsetLeft <= window.screen.availWidth - 10)
			t.style.left = t.offsetLeft + 10 + "px";
		}
		
	}
	let trash = new Image();
	
	function getFish(){
		//éšæœºç”ŸæˆğŸŸ,å¦‚æœç¢°åˆ°åƒåœ¾,å¡‘æ–™è¢‹å˜å¤§,é±¼è¢«è£…å…¥å¡‘æ–™è¢‹
		for(var i = 0; i< 6;i++){
			fishes[i] = 1;
			var width = parseInt(Math.random()*(window.screen.availWidth-50),10);//å®½åº¦
			var height = parseInt(Math.random()*(window.screen.availHeight-100),10);//é«˜åº¦
			var fish = new Image();
			fish.width = 30;
			fish.height = 25;
			fish.src = "img/fish3.jpg";
			fish.id = "fish"+i;
			fish.name = "fish";
			$("body").append(fish);
			var f = document.getElementById("fish"+i);
			f.style.left = width + "px";
			f.style.top = height + "px";
			f.style.position = "absolute";
		}
		
	}
	function getAnothgerFish(i){
		var width = parseInt(Math.random()*(window.screen.availWidth-50),10);//å®½åº¦
		var height = parseInt(Math.random()*(window.screen.availHeight-100),10);//é«˜åº¦
		var fish = new Image();
		fish.width = 30;
		fish.height = 25;
		fish.src = "img/fish3.jpg";
		fish.id = "fish"+i;
		fish.name = "fish";
		$("body").append(fish);
		var f = document.getElementById("fish"+i);
		f.style.left = width + "px";
		f.style.top = height + "px";
		f.style.position = "absolute";
		fishes[i] =1;
		if(grade == 50){
			$("body").attr("background","img/graySea1.jpg");
			showMiddle();
		}
		else if(grade == 100){
			$("body").attr("background","img/graySea.jpg");
			showEnd();
		}
	}
	//åˆ¤æ–­2ä¸ªdivæ˜¯å¦æœ‰äº¤é›†,åˆ¤æ–­æ—¶ä»¥obj1ä½œä¸ºå›ºå®šçš„obj2ä½œä¸ºç§»åŠ¨çš„
            function check(oDiv, oDiv2) {
                var t1 = oDiv.offsetTop;
                var l1 = oDiv.offsetLeft;
                var r1 = oDiv.offsetLeft + oDiv.offsetWidth;
                var b1 = oDiv.offsetTop + oDiv.offsetHeight;
 
                var t2 = oDiv2.offsetTop;
                var l2 = oDiv2.offsetLeft;
                var r2 = oDiv2.offsetLeft + oDiv2.offsetWidth;
                var b2 = oDiv2.offsetTop + oDiv2.offsetHeight;
                if(b1<t2 || l1>r2 || t1>b2 || r1<l2){// è¡¨ç¤ºæ²¡ç¢°ä¸Š
					return false;
                }else{
                    return true;
                }
            }
	function showStart(){//åˆšå¼€å§‹çš„æ˜¾ç¤ºä¿¡æ¯-0%
		jsPanel.create({
		    theme:       'primary',
		    headerTitle: 'åˆšå¼€å§‹',
		    position:    'center-top 0 58',
		    contentSize: '450 250',
		    content:     '<p>åˆšå¼€å§‹çš„æµ·æ´‹æ˜¯å¤šä¹ˆçš„è”šè“ï¼Œå¯æ˜¯ä¹‹åâ€¦â€¦</p>',
		    callback: function () {
		        this.content.style.padding = '20px';
		    },
		    onbeforeclose: function () {
		        return confirm('ä½ æƒ³çŸ¥é“ä¹‹åçš„äº‹æƒ…ä¹ˆ');
		    }
		});
	}
	function showMiddle(){//ä¸­é€”æ˜¾ç¤ºä¿¡æ¯-50%
		jsPanel.create({
		    theme:       'primary',
		    headerTitle: 'æé†’',
		    position:    'center-top 0 58',
		    contentSize: '450 250',
		    content:     '<p>æ±¡æŸ“è¾¾åˆ°50%ï¼Œæ³¨æ„çœ‹ä½ èº«åçš„æµ·æ´‹ï¼Œæ˜¯ä¸æ˜¯å’Œåˆšå¼€å§‹æœ‰äº†å˜åŒ–</p>',
		    callback: function () {
		        this.content.style.padding = '20px';
		    },
		    onbeforeclose: function () {
		        return confirm('ä½ è¿˜è¦ç»§ç»­ä¹ˆï¼Ÿ');
		    }
		});
	}
	function showEnd(){//æœ€ç»ˆæ˜¾ç¤ºä¿¡æ¯-99%
		jsPanel.create({
		    theme:       'primary',
		    headerTitle: 'è­¦å‘Š',
		    position:    'center-top 0 58',
		    contentSize: '450 250',
		    content:     '<p>ç°åœ¨æµ·æ´‹å·²ç»è¢«æ±¡æŸ“äº†99%ï¼Œä½ è¿˜è¦ç»§ç»­ç ´åä¸‹å»ä¹ˆï¼Ÿ</p>',
		    callback: function () {
		        this.content.style.padding = '20px';
		    },
		    onbeforeclose: function () {
		        return confirm('ç°åœ¨å…³é—­è¿™ä¸ªç½‘é¡µï¼Œå¼€å§‹ä¿æŠ¤ç¯å¢ƒå§ï¼');
		    }
		});
	}
	 function play(){//æ¸¸æˆå‡½æ•°
		 
	 }
	showStart();
	
	getFish();
	
	
</script>
</body>
</html>
